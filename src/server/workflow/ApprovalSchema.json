{
  "name": "InvoiceApproval",
  "initialState": "inspectionRequired",
  "finalStates": [
    "archived"
  ],
  "objectStateFieldName": "status",
  "transitions": [
    {
      "from": "inspectionRequired",
      "event": "inspect",
      "to": "approvalRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-inspector"
            ]
        },
        {
          "name": "isGreaterOrEqual",
          "arguments": {
            "amount": 200,
            "field": "grossAmount"
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        },
        {
          "name": "updateProcessedBy",
          "arguments": {
            "processedByFieldName": "inspectedBy"
          }
        }
      ]
    },
    {
      "from": "inspectionRequired",
      "event": "automatic-inspect",
      "to": "approvalRequired",
      "automatic": true,
      "guards": [
        {
          "name": "isLessThan",
          "arguments": {
            "amount": 200,
            "field": "grossAmount"
          }
        }
      ]
    },
    {
      "from": "inspectionRequired",
      "event": "postComment",
      "to": "inspectionRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-inspector"
            ]
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        }
      ]
    },
    {
      "from": "inspectionRequired",
      "event": "sendToClarification",
      "to": "inspClrRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-inspector"
            ]
          }
        },
        {
          "name": "isGreaterOrEqual",
          "arguments": {
            "amount": 200,
            "field": "grossAmount"
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        }
      ]
    },
    {
      "from": "inspClrRequired",
      "event": "clarifyForInspection",
      "to": "inspectionRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-inspector"
            ]
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        }
      ]
    },
    {
      "from": "inspClrRequired",
      "event": "postComment",
      "to": "inspClrRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-inspector"
            ]
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        }
      ]
    },
    {
      "from": "approvalRequired",
      "event": "approve",
      "to": "approved",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-approver"
            ]
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        },
        {
          "name": "updateProcessedBy",
          "arguments": {
            "processedByFieldName": "approvedBy"
          }
        }
      ]
    },
    {
      "from": "approved",
      "event": "rejectApproval",
      "to": "approvalRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-approver"
            ]
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        },
        {
          "name": "updateProcessedBy",
          "arguments": {
            "processedByFieldName": "approvedBy",
            "userId": null
          }
        }
      ]
    },
    {
      "from": "approvalRequired",
      "event": "rejectInspection",
      "to": "inspectionRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-approver",
              "invoice-inspector"
            ]
          }
        },
        {
          "name": "isGreaterOrEqual",
          "arguments": {
            "amount": 200,
            "field": "grossAmount"
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        },
        {
          "name": "updateProcessedBy",
          "arguments": {
            "processedByFieldName": "inspectedBy",
            "userId": null
          }
        }
      ]
    },
    {
      "from": "approvalRequired",
      "event": "postComment",
      "to": "approvalRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-approver"
            ]
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        }
      ]
    },
    {
      "from": "approvalRequired",
      "event": "sendToClarification",
      "to": "appClrRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-approver"
            ]
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        }
      ]
    },
    {
      "from": "appClrRequired",
      "event": "clarifyForApproval",
      "to": "approvalRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-approver"
            ]
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        }
      ]
    },
    {
      "from": "appClrRequired",
      "event": "postComment",
      "to": "appClrRequired",
      "guards": [
        {
          "name": "userHasRoles",
          "arguments": {
            "restrictedRoles": [
              "invoice-approver"
            ]
          }
        }
      ],
      "actions": [
        {
          "name": "updateComment",
          "arguments": {
            "commentFieldName": "commentary"
          }
        }
      ]
    }
  ]
}
